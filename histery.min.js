/*!
 * Histery.js v0.7.0, https://github.com/hoho/histery
 * (c) 2013 Marat Abdullin, MIT license
 */
!function(a,b,c,d){var e,f,g,h,i,j,k=a.history||{},l=[],m=[],n=0,o=[],p={}.constructor,q=function(a){return"function"==typeof a},r=function(a){return a&&a.constructor===p},s=function(a,d){return d=b,a&&(d=c.createElement("a"),d.href=a),d=d.pathname+d.search+(d.hash.length>1?d.hash:""),"/"===d[0]?d:"/"+d},t=function(a,b,c,d,e){return b instanceof RegExp?(c=0,d=a.replace(b,function(){return c++,e=Array.prototype.slice.call(e=arguments,1,e.length-2),""})):q(b)?(c=1,e=b(a),!e||e instanceof Array||(e=[e])):a===b&&(c=1,e=[]),1!==c||d?void 0:e},u=function(a,b,c,d,e){return a.replace(/^([^?#]+)(?:\?([^#]*))?(?:#(.*))?$/,function(a,b,f,g){c=b||"",d=f||"",e=g||""}),c&&(r(b)?(c=b.pathname?t(c,b.pathname):[],d=b.search?t(d,b.search):[],e=b.hash?t(e,b.hash):[]):(c=t(c,b),d=e=[]),c&&d&&e)?[a].concat(c,d,e):void 0},v=function(a,b,c,d,e){for(d=0;d<b.length;d++)e=b[d],e[0]===a&&c.push(e[1])},w=function(a,b){for(;b=a.shift();)b()},x=function(a,b){if(r(a)&&r(b)){var c,d=[],e=[];for(c in a){if(!(c in b))return!1;d.push(c)}for(c in b){if(!(c in a))return!1;e.push(c)}if(d.length!==e.length)return!1;for(c=0;c<d.length;c++)if(!x(a[d[c]],b[d[c]]))return!1;return!0}return a===b},y=function(a,b,c,d){if(a=a||[],b=b||[],a.length!==b.length)d=!1;else for(d=!0,c=2;c<a.length;c++)if(!x(a[c],b[c])){d=!1;break}return d};a.$H=e={run:function(){var f=c.createEvent("HTMLEvents"),g=function(){i&&i===b.href||(j&&a.clearTimeout(j),i=b.href,h=!0,e.go(),j=a.setTimeout(function(){j=d,i=d},500))};return a.addEventListener("popstate",g),a.addEventListener("hashchange",g),f.initEvent("popstate",!0,!1),a.dispatchEvent(f),e},go:function(a){var c,i,j,n=[],p=!1,r={},t=[],x=[];for(a=s(a),i=0;i<l.length;i++)f=l[i],(!f.h||(j=u(a,f.h)))&&(f.h?r[i]=p=!0:j=[a],function(a,b){a.unshift(d),a[0]=y(f.cur,a),f.cur=a;var c=f,e=!!f.h;q(b)&&(b=b()),b.go&&t.push([e,function(){b.go.apply(b,a)}]),b.leave&&x.push([e,function(){a[0]=y(c.cur,a),b.leave.apply(b,a)}])}(j,f.c));for(v(p,t,n),c=0;c<l.length;c++)f=l[c],f.cur=p&&r[c]||!p&&!f.h?f.cur:null;for(w(o),v(p,x,o),g&&(k.pushState?h||k.pushState(null,null,a):b.href=a),g=!0,h=!1,w(n),c=0;c<m.length;c++)m[c](a);return e},on:function(a,b){return a===d?m.push(b):(l.push({h:a,c:b,cur:null}),a||n++),e},off:function(a,b){var c,f;if(a===d)for(c=m.length-1;c>=0;)m[c]===b&&m.splice(c,1),c--;else for(a||b||(l=[]),c=l.length-1;c>=0;)f=l[c],f.h!==a||b&&f.c!==b||(l.splice(c,1),f.h||n--),c--;return e}}}(window,location,document);